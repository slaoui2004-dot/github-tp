<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Maroc Tourisme</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial; margin:0; background:#F5F1E8; }
header { background:#1A365D; color:white; padding:40px; text-align:center; }
h1 { margin-bottom:20px; }
section { max-width:1000px; margin:40px auto; padding:20px; }
.city-card { background:white; padding:20px; margin-bottom:20px; border-radius:10px; }
button { padding:10px; background:#D4AF37; border:none; font-weight:bold; }
input, select { width:100%; padding:8px; margin-bottom:10px; }
.success { color:green; }
.error { color:red; }
</style>
</head>

<body>

<header>
<h1 id="main-title">Chargement...</h1>
</header>

<section>
<h2>Nos Destinations</h2>
<div id="cities-container"></div>
</section>

<section>
<h2>Réserver votre destination</h2>

<form id="reservation-form">
<input type="text" id="nom" placeholder="Nom" required>
<input type="text" id="prenom" placeholder="Prénom" required>
<input type="tel" id="telephone" placeholder="Téléphone" required>

<select id="ville" required>
<option value="">Choisir une ville</option>
<option value="Casablanca">Casablanca</option>
<option value="Tanger">Tanger</option>
<option value="Fès">Fès</option>
<option value="Marrakech">Marrakech</option>
</select>

<button type="submit">Envoyer</button>
</form>

<p id="form-message"></p>
</section>

<script>
const API_BASE = "https://maroctourisme-back-g6hghbb8fgaxcpbb.newzealandnorth-01.azurewebsites.net";

// Charger titre
async function loadTitle() {
  const res = await fetch(`${API_BASE}/api/title`);
  const data = await res.json();
  document.getElementById("main-title").textContent = data.title;
}

// Charger villes
async function loadCities() {
  const res = await fetch(`${API_BASE}/api/cities`);
  const cities = await res.json();
  const container = document.getElementById("cities-container");
  container.innerHTML = "";

  cities.forEach(city => {
    const div = document.createElement("div");
    div.className = "city-card";
    div.innerHTML = `
      <h3>${city.name}</h3>
      <p><em>${city.subtitle}</em></p>
      ${city.description ? `<p>${city.description}</p>` : ""}
      <ul>
        ${city.highlights.map(h => `<li>${h}</li>`).join("")}
      </ul>
    `;
    container.appendChild(div);
  });
}

// POST réservation
document.getElementById("reservation-form")
.addEventListener("submit", async function(e) {

  e.preventDefault();

  const nom = document.getElementById("nom").value;
  const prenom = document.getElementById("prenom").value;
  const telephone = document.getElementById("telephone").value;
  const ville = document.getElementById("ville").value;

  const message = document.getElementById("form-message");

  try {
    const res = await fetch(`${API_BASE}/api/reservations`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nom, prenom, telephone, ville })
    });

    const data = await res.json();

    if (!res.ok) throw new Error(data.error);

    message.className = "success";
    message.textContent = "Réservation envoyée avec succès !";

    document.getElementById("reservation-form").reset();

  } catch (err) {
    message.className = "error";
    message.textContent = err.message;
  }
});

// Initialisation
document.addEventListener("DOMContentLoaded", () => {
  loadTitle();
  loadCities();
});
</script>

</body>
</html>
